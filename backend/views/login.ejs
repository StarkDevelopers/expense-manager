<!DOCTYPE html>
<html lang="en">

<head>
    <title>Stark Mailer Login</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"
      integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB"
      crossorigin="anonymous"
    />
    <style>
      input:focus {
        outline: none;
      }
      ::placeholder { /* Chrome, Firefox, Opera, Safari 10.1+ */
        color: #a8aed2;
        opacity: 0.5; /* Firefox */
        font-size: 1rem;
        text-align: right;
      }
      :-ms-input-placeholder { /* Internet Explorer 10-11 */
        color: #a8aed2;
      }
      ::-ms-input-placeholder { /* Microsoft Edge */
        color: #a8aed2;
      }
      input:-webkit-autofill,
      input:-webkit-autofill:hover, 
      input:-webkit-autofill:focus {
        color: #a8aed2 !important;
        -webkit-text-fill-color: #a8aed2 !important;
        box-shadow: 0 0 0 1000px #464c6c inset, 3px 3px 5px 1px #2e324d;
        -webkit-box-shadow: 0 0 0 1000px #464c6c inset, 3px 3px 5px 1px #2e324d;
      }
      html, body {
        height: 100%;
        background-image: linear-gradient(to right, #464c6c, #353c5c);
        color: #a8aed2;
        font-family: "Ubuntu", sans-serif;
      }
      .container {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
      }
      .cardBody {
        background-image: linear-gradient(to right, #464c6c, #404767);
        border-width: 0px;
        box-shadow: 3px 3px 5px 1px #2e324d;
        padding: 2rem;
        text-align: center;
        width: 50%;
      }
      .title {
        font-family: 'Limelight', cursive;
      }
      .smalltitle {
        margin-bottom: 2rem;
      }
      .field {
        width: 100%;
        height: 3rem;
        font-size: 1.5rem;
        background-image: linear-gradient(to right, #464c6c, #404767);
        border-width: 0px;
        box-shadow: 3px 3px 5px 1px #2e324d;
        padding: 0.75rem;
        box-sizing: border-box;
        margin-bottom: 1rem;
        color: #a8aed2;
      }
      .submitButton {
        margin-top: 1rem;
        padding: 0;
        cursor: pointer;
      }
      .helpText {
        text-align: left;
        cursor: pointer;
      }
      .sendCodeText {
        text-align: right;
        cursor: pointer;
      }
      .sendCodeInterval {
        text-align: right;
      }
      .signin {
        display: block;
      }
      .signup {
        display: none;
      }
      .message {
        z-index: 1000;
        display: none;
        width: 24%;
        position: absolute;
        top: 1rem;
        text-align: center;
        left: 50%;
        margin-left: -12%;
      }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Limelight&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
  <div class="alert alert-primary message" role="alert"></div>
  <div class="container">
    <div class="row cardBody">
      <div class="col-12">
        <h1 class="title">DINERO</h1>
        <h6 class="smalltitle">Manage money in style</h6>
        <form action="/" id="signin" class="signin">
          <input type="text" value="" placeholder="Username" class="field" />
          <input type="password" value="" placeholder="Password" class="field" />
          <input type="submit" value="Sign In" class="field submitButton" />
          <h6 class="helpText" onclick="changeForm('signup')">Does not have an account?</h6>
        </form>
        <form action="/" id="signup" class="signup">
          <input type="email" value="" placeholder="E-mail" class="field" id="email" />
          <h6 class="sendCodeText" id="sendCodeText" onclick="sendCode()">Send code</h6>
          <h6 class="sendCodeInterval" id="sendCodeInterval"></h6>
          <input type="password" value="" placeholder="E-mail Code" class="field" />
          <input type="text" value="" placeholder="Username" class="field" />
          <input type="password" value="" placeholder="Password" class="field" />
          <input type="submit" value="Sign Up" class="field submitButton" />
          <h6 class="helpText" onclick="changeForm('signin')">Already have an account?</h6>
        </form>
      </div>
    </div>
  </div>
  <script
    src="http://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"
  ></script>
  <script
    src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"
    integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T"
    crossorigin="anonymous"
  ></script>
  <script>
    let timeout = null;
    let sendCodeInterval = null;
    let interval = 60;
    let changeForm = (to) => {
      if (to === 'signup') {
        $('#signin').css('display', 'none');
        $('#signup').css('display', 'block');
      } else if (to === 'signin') {
        $('#signup').css('display', 'none');
        $('#signin').css('display', 'block');
      }
    };
    let sendCode = () => {
      const email = $('#email').val();
      const pattern = /^\b[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b$/i;
      const valid = pattern.test(email);
      if (!valid) {
        showAlert('Enter a valid E-mail', 'danger');
      } else {
        $('#sendCodeText').css('display', 'none');
        $('#sendCodeInterval').css('display', 'block');
        sendCodeInterval = setInterval(() => {
          if (interval === 0) {
            clearInterval(sendCodeInterval);
            $('#sendCodeInterval').css('display', 'none');
            $('#sendCodeText').css('display', 'block');
            interval = 60;
          }
          $('#sendCodeInterval').html(`Send code again in ${--interval}s`);
        }, 1000);
        // process Email
        $.post( '/sendSignupCode', { email } )
          .done(data => {
            showAlert('Code sent', 'success');
          })
          .fail(error => {
            showAlert(error.responseText, 'danger');
          });
      }
    };
    let showAlert = (message, level) => {
      if (timeout) {
        clearTimeout(timeout);
      }
      $('.alert').css('display', 'block')
        .html(message)
        .removeClass('alert-success')
        .removeClass('alert-danger')
        .addClass(`alert-${level}`);
      timeout = setTimeout(() => {
        $('.alert').css('display', 'none');
      }, 2000);
    }
  </script>
</body>
</html>
